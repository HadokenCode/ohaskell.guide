% Строим книгу.
\documentclass[$if(fontsize)$$fontsize$$endif$,oneside]{book}

% Задаём русский и моноширинный шрифты.
\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}
\setmainfont{PT Serif}
\setsansfont{PT Sans}
\setmonofont[Mapping=tex-ansi,Scale=0.9]{Ubuntu Mono}

% Поддержка русского языка с переносами.
\usepackage{polyglossia}
\setdefaultlanguage[]{russian}
\setmainlanguage[]{russian}
\setotherlanguage[]{english}
\newfontfamily\cyrillicfont{PT Serif}

% Для красивых колонтитулов.
\usepackage{fancyhdr}

% Абзацы без горизонтального отступа, но с вертиальным отступом.
\usepackage[parfill]{parskip}

% Задаём метаданные и характеристики гиперссылок.
\usepackage{hyperref}
\PassOptionsToPackage{usenames,dvipsnames}{color} % color is loaded by hyperref
\hypersetup{unicode=true,
            pdftitle={О Haskell по-человечески},
            pdfauthor={Денис Шевченко},
            pdfsubject={Ваша первая книга о языке программирования Haskell},
            colorlinks=true,
            linkcolor=Maroon,
            citecolor=Blue,
            urlcolor=Blue,
            pdfborder={0 0 0},
            breaklinks=true}
% Шрифт гиперссылок не моноширинный.
\urlstyle{same}

\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\usepackage{color}
\usepackage{fancyvrb}
\VerbatimFootnotes % allows verbatim text in footnotes

\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}

% Для увеличенного интерлиньяжа.
\usepackage{setspace}

\usepackage{textcomp}

% Титульная страница книги.
\newcommand*{\ohaskelltitle}{\begingroup
\newlength{\drop} % Command for generating a specific amount of whitespace
\drop=0.1\textheight % Define the command as 10% of the total text height

\vspace{\drop} % Whitespace between the top lines and title
\centering % Center all text
\textcolor{MidnightBlue}{ % Red font color
{\Huge О Haskell по-человечески}\\[0.5\baselineskip] % Title line 1
\vspace{15pt}
{\Large издание 2.0}
} % Title line 3

\vspace{0.25\drop}
\rule{0.3\textwidth}{0.4pt}\par
\vspace{\drop}

{\large \textsc{Денис Шевченко}}\par

\vfill
{\large \textsc{www.ohaskell.guide}}\par
{\Large \textsc{2016}}\par
\endgroup}

% Вторая страница, со ссылкой на лицензию CC.
\newcommand*{\ohaskelllicense}{\begingroup
\vspace*{\fill}
\centering
{\large \textsc{Книга свободно распространяется на условиях лицензии \href{http://creativecommons.org/licenses/by-nc/4.0/deed.ru}{CC BY-NC 4.0}}}\par
{\footnotesize \textsc{\textcopyright \enspace Денис Шевченко, 2014-2016}}\par
\vspace*{\fill}
\endgroup}

\begin{document}

% Титульная и лицензионная страницы - без нумерации.
\pagestyle{empty}
\ohaskelltitle
\newpage
\pagestyle{empty}
\ohaskelllicense

% Устанавливаем цвет ссылок в Оглавлении.
\hypersetup{linkcolor=black}
% Части глав не нумеруются, только главы.
\setcounter{secnumdepth}{0}
\setcounter{tocdepth}{1}
\pagestyle{empty}
% Двойной интерлиньяж для пунктов в Оглавлении.
\doublespacing
\tableofcontents
% Возвращаем нормальный интерлиньяж.
\singlespacing
\thispagestyle{empty}
\clearpage

% Устанавливаем колонтитулы (в данном случае используется только верхний).
\pagestyle{fancy}
\fancyhf{}
% В верхнем левом углу - название текущей главы.
\fancyhead[L]{\fontsize{10}{12} \selectfont \rmfamily{\nouppercase\leftmark}}
% В верхнем правом углу - номер текущей страницы.
\fancyhead[R]{\fontsize{10}{12} \selectfont \rmfamily{\thepage}}

$body$

\end{document}

